var cnUtil=function(e){var t=$.extend({},e);t.coinUnits=new JSBigInt(10).pow(t.coinUnitPlaces);var r=t.addressPrefix,a=t.integratedAddressPrefix,o=new JSBigInt(2).pow(64),l=32,n=160,u=120,d=160,c=32,s=32,_=32,f=1280,h=64,b="8b655970153799af2aeadc9ff1add0ea6c7251d54154cfa92c173a0dd39c1f94",m=JSBigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),g="0100000000000000000000000000000000000000000000000000000000000000",v="0000000000000000000000000000000000000000000000000000000000000000",M=["8b655970153799af2aeadc9ff1add0ea6c7251d54154cfa92c173a0dd39c1f94","8faa448ae4b3e2bb3d4d130909f55fcd79711c1c83cdbccadd42cbe1515e8712","12a7d62c7791654a57f3e67694ed50b49a7d9e3fc1e4c7a0bde29d187e9cc71d","789ab9934b49c4f9e6785c6d57a498b3ead443f04f13df110c5427b4f214c739","771e9299d94f02ac72e38e44de568ac1dcb2edc6edb61f83ca418e1077ce3de8","73b96db43039819bdaf5680e5c32d741488884d18d93866d4074a849182a8a64","8d458e1c2f68ebebccd2fd5d379f5e58f8134df3e0e88cad3d46701063a8d412","09551edbe494418e81284455d64b35ee8ac093068a5f161fa6637559177ef404","d05a8866f4df8cee1e268b1d23a4c58c92e760309786cdac0feda1d247a9c9a7","55cdaad518bd871dd1eb7bc7023e1dc0fdf3339864f88fdd2de269fe9ee1832d","e7697e951a98cfd5712b84bbe5f34ed733e9473fcb68eda66e3788df1958c306","f92a970bae72782989bfc83adfaa92a4f49c7e95918b3bba3cdc7fe88acc8d47","1f66c2d491d75af915c8db6a6d1cb0cd4f7ddcd5e63d3ba9b83c866c39ef3a2b","3eec9884b43f58e93ef8deea260004efea2a46344fc5965b1a7dd5d18997efa7","b29f8f0ccb96977fe777d489d6be9e7ebc19c409b5103568f277611d7ea84894","56b1f51265b9559876d58d249d0c146d69a103636699874d3f90473550fe3f2c","1d7a36575e22f5d139ff9cc510fa138505576b63815a94e4b012bfd457caaada","d0ac507a864ecd0593fa67be7d23134392d00e4007e2534878d9b242e10d7620","f6c6840b9cf145bb2dccf86e940be0fc098e32e31099d56f7fe087bd5deb5094","28831a3340070eb1db87c12e05980d5f33e9ef90f83a4817c9f4a0a33227e197","87632273d629ccb7e1ed1a768fa2ebd51760f32e1c0b867a5d368d5271055c6e","5c7b29424347964d04275517c5ae14b6b5ea2798b573fc94e6e44a5321600cfb","e6945042d78bc2c3bd6ec58c511a9fe859c0ad63fde494f5039e0e8232612bd5","36d56907e2ec745db6e54f0b2e1b2300abcb422e712da588a40d3f1ebbbe02f6","34db6ee4d0608e5f783650495a3b2f5273c5134e5284e4fdf96627bb16e31e6b","8e7659fb45a3787d674ae86731faa2538ec0fdf442ab26e9c791fada089467e9","3006cf198b24f31bb4c7e6346000abc701e827cfbb5df52dcfa42e9ca9ff0802","f5fd403cb6e8be21472e377ffd805a8c6083ea4803b8485389cc3ebc215f002a","3731b260eb3f9482e45f1c3f3b9dcf834b75e6eef8c40f461ea27e8b6ed9473d","9f9dab09c3f5e42855c2de971b659328a2dbc454845f396ffc053f0bb192f8c3","5e055d25f85fdb98f273e4afe08464c003b70f1ef0677bb5e25706400be620a5","868bcf3679cb6b500b94418c0b8925f9865530303ae4e4b262591865666a4590","b3db6bd3897afbd1df3f9644ab21c8050e1f0038a52f7ca95ac0c3de7558cb7a","8119b3a059ff2cac483e69bcd41d6d27149447914288bbeaee3413e6dcc6d1eb","10fc58f35fc7fe7ae875524bb5850003005b7f978c0c65e2a965464b6d00819c","5acd94eb3c578379c1ea58a343ec4fcff962776fe35521e475a0e06d887b2db9","33daf3a214d6e0d42d2300a7b44b39290db8989b427974cd865db011055a2901","cfc6572f29afd164a494e64e6f1aeb820c3e7da355144e5124a391d06e9f95ea","d5312a4b0ef615a331f6352c2ed21dac9e7c36398b939aec901c257f6cbc9e8e","551d67fefc7b5b9f9fdbf6af57c96c8a74d7e45a002078a7b5ba45c6fde93e33","d50ac7bd5ca593c656928f38428017fc7ba502854c43d8414950e96ecb405dc3","0773e18ea1be44fe1a97e239573cfae3e4e95ef9aa9faabeac1274d3ad261604","e9af0e7ca89330d2b8615d1b4137ca617e21297f2f0ded8e31b7d2ead8714660","7b124583097f1029a0c74191fe7378c9105acc706695ed1493bb76034226a57b","ec40057b995476650b3db98e9db75738a8cd2f94d863b906150c56aac19caa6b","01d9ff729efd39d83784c0fe59c4ae81a67034cb53c943fb818b9d8ae7fc33e5","00dfb3c696328c76424519a7befe8e0f6c76f947b52767916d24823f735baf2e","461b799b4d9ceea8d580dcb76d11150d535e1639d16003c3fb7e9d1fd13083a8","ee03039479e5228fdc551cbde7079d3412ea186a517ccc63e46e9fcce4fe3a6c","a8cfb543524e7f02b9f045acd543c21c373b4c9b98ac20cec417a6ddb5744e94","932b794bf89c6edaf5d0650c7c4bad9242b25626e37ead5aa75ec8c64e09dd4f","16b10c779ce5cfef59c7710d2e68441ea6facb68e9b5f7d533ae0bb78e28bf57","0f77c76743e7396f9910139f4937d837ae54e21038ac5c0b3fd6ef171a28a7e4","d7e574b7b952f293e80dde905eb509373f3f6cd109a02208b3c1e924080a20ca","45666f8c381e3da675563ff8ba23f83bfac30c34abdde6e5c0975ef9fd700cb9","b24612e454607eb1aba447f816d1a4551ef95fa7247fb7c1f503020a7177f0dd","7e208861856da42c8bb46a7567f8121362d9fb2496f131a4aa9017cf366cdfce","5b646bff6ad1100165037a055601ea02358c0f41050f9dfe3c95dccbd3087be0","746d1dccfed2f0ff1e13c51e2d50d5324375fbd5bf7ca82a8931828d801d43ab","cb98110d4a6bb97d22feadbc6c0d8930c5f8fc508b2fc5b35328d26b88db19ae","60b626a033b55f27d7676c4095eababc7a2c7ede2624b472e97f64f96b8cfc0e","e5b52bc927468df71893eb8197ef820cf76cb0aaf6e8e4fe93ad62d803983104","056541ae5da9961be2b0a5e895e5c5ba153cbb62dd561a427bad0ffd41923199","f8fef05a3fa5c9f3eba41638b247b711a99f960fe73aa2f90136aeb20329b888"];function p(e,t){if(!valid_hex(t)||64!==t.length||!valid_hex(e)||64!==e.length)throw"invalid amount or mask!";return ge_double_scalarmult_base_vartime(e,b,t)}function y(e){if(e.length%2!=0)return"length must be a multiple of 2!";for(var t="",r=1;r<=e.length/2;r++)t+=e.substr(0-2*r,2);return t}function w(e){return y(function(e){if("string"!=typeof e&&e.toString().length>15)throw"integer should be entered as a string for precision";var t="";for(i=0;i<63;i++)t+="0";return(t+JSBigInt(e).toString(16).toLowerCase()).slice(-64)}(e))}function k(e){return JSBigInt.parse(y(e),16).toString()}function x(e){if("string"!=typeof e&&e.toString().length>15)throw"integer should be entered as a string for precision";var t="";for(i=0;i<63;i++)t+="0";var r=new JSBigInt(e);if(r.toString(2).length>64)throw"amount overflows uint64!";return function(e){for(var t="",r=1;r<=e.length;r++)t+=e.substr(0-r,1);return t}((t+r.toString(2)).slice(-64))}function U(e){if(e.length%2!=0)throw"Hex string has invalid length!";for(var t=new Uint8Array(e.length/2),r=0;r<e.length/2;++r)t[r]=parseInt(e.slice(2*r,2*r+2),16);return t}function P(e){for(var t=[],r=0;r<e.length;++r)t.push(("0"+e[r].toString(16)).slice(-2));return t.join("")}function E(e){for(var t="",r=0;r<e.length;r++){if("string"!=typeof e[r])throw"unexpected array element";t+=e[r]}return hash_to_scalar(t)}return this.valid_hex=function(e){return new RegExp("[0-9a-fA-F]{"+e.length+"}").test(e)},this.hex_xor=function(e,t){if(!e||!t||e.length!==t.length||e.length%2!=0||t.length%2!=0)throw"Hex string(s) is/are invalid!";var r=U(e),a=U(t),o=new Uint8Array(r.length);for(i=0;i<o.length;i++)o[i]=r[i]^a[i];return P(o)},this.rand_32=function(){return mn_random(256)},this.rand_16=function(){return mn_random(128)},this.encode_varint=function(e){e=new JSBigInt(e);for(var t="";e.compare(128)>=0;)t+=("0"+(127&e.lowVal()|128).toString(16)).slice(-2),e=e.divide(new JSBigInt(2).pow(7));return t+("0"+e.toJSValue().toString(16)).slice(-2)},this.sc_reduce=function(e){var t=U(e);if(64!==t.length)throw"Invalid input length";var r=Module._malloc(64);Module.HEAPU8.set(t,r),Module.ccall("sc_reduce","void",["number"],[r]);var a=Module.HEAPU8.subarray(r,r+64);return Module._free(r),P(a)},this.sc_reduce32=function(e){var t=U(e);if(32!==t.length)throw"Invalid input length";var r=Module._malloc(32);Module.HEAPU8.set(t,r),Module.ccall("sc_reduce32","void",["number"],[r]);var a=Module.HEAPU8.subarray(r,r+32);return Module._free(r),P(a)},this.cn_fast_hash=function(e,t){if(e.length%2!=0||!this.valid_hex(e))throw"Input invalid";return keccak_256(U(e))},this.sec_key_to_pub=function(e){var t=U(e);if(32!==t.length)throw"Invalid input length";var r=Module._malloc(l);Module.HEAPU8.set(t,r);var a=Module._malloc(n),o=Module._malloc(l);Module.ccall("ge_scalarmult_base","void",["number","number"],[a,r]),Module.ccall("ge_p3_tobytes","void",["number","number"],[o,a]);var u=Module.HEAPU8.subarray(o,o+l);return Module._free(a),Module._free(r),Module._free(o),P(u)},this.ge_scalarmult_base=function(e){return this.sec_key_to_pub(e)},this.ge_scalarmult=function(e,t){if(64!==e.length||64!==t.length)throw"Invalid input length";var r=U(e),a=U(t),o=Module._malloc(l);Module.HEAPU8.set(r,o);var d=Module._malloc(l);Module.HEAPU8.set(a,d);var c=Module._malloc(n),i=Module._malloc(u);if(0!==Module.ccall("ge_frombytes_vartime","bool",["number","number"],[c,o]))throw"ge_frombytes_vartime returned non-zero error code";Module.ccall("ge_scalarmult","void",["number","number","number"],[i,d,c]);var s=Module._malloc(l);Module.ccall("ge_tobytes","void",["number","number"],[s,i]);var _=Module.HEAPU8.subarray(s,s+l);return Module._free(o),Module._free(d),Module._free(c),Module._free(i),Module._free(s),P(_)},this.pubkeys_to_string=function(e,t){var a=this.encode_varint(r)+e+t,o=this.cn_fast_hash(a);return cnBase58.encode(a+o.slice(0,8))},this.generate_keys=function(e){if(64!==e.length)throw"Invalid input length!";var t=this.sc_reduce32(e);return{sec:t,pub:this.sec_key_to_pub(t)}},this.random_keypair=function(){return this.generate_keys(this.rand_32())},this.random_scalar=function(){return this.sc_reduce32(this.rand_32())},this.create_address=function(e){var t,r={};t=64!==e.length?this.cn_fast_hash(e):e,r.spend=this.generate_keys(t);var a=this.cn_fast_hash(t);return r.view=this.generate_keys(a),r.public_addr=this.pubkeys_to_string(r.spend.pub,r.view.pub),r},this.create_addr_prefix=function(e){var t;t=64!==e.length?this.cn_fast_hash(e):e;var a=this.generate_keys(t),o=this.encode_varint(r);return cnBase58.encode(o+a.pub).slice(0,44)},this.decode_address=function(e){var t=cnBase58.decode(e),o=this.encode_varint(r),l=this.encode_varint(a),n=t.slice(0,o.length);if(n!==o&&n!==l)throw"Invalid address prefix";var u=(t=t.slice(o.length)).slice(0,64),d=t.slice(64,128);if(n===l)var c=t.slice(128,144),i=t.slice(144,152),s=this.cn_fast_hash(n+u+d+c).slice(0,8);else i=t.slice(128,136),s=this.cn_fast_hash(n+u+d).slice(0,8);if(i!==s)throw"Invalid checksum";return c?{spend:u,view:d,intPaymentId:c}:{spend:u,view:d}},this.valid_keys=function(e,t,r,a){var o=this.sec_key_to_pub(t);return this.sec_key_to_pub(a)===r&&o===e},this.decode_rct_ecdh=function(e,t){var r=this.hash_to_scalar(t),a=this.hash_to_scalar(r);return{mask:sc_sub(e.mask,r),amount:sc_sub(e.amount,a)}},this.encode_rct_ecdh=function(e,t){var r=this.hash_to_scalar(t);return this.hash_to_scalar(r),{mask:sc_add(e.mask,r),amount:sc_add(e.amount)}},this.hash_to_scalar=function(e){var t=this.cn_fast_hash(e);return this.sc_reduce32(t)},this.generate_key_derivation=function(e,t){if(64!==e.length||64!==t.length)throw"Invalid input length";var r=U(e),a=U(t),o=Module._malloc(l);Module.HEAPU8.set(r,o);var c=Module._malloc(l);Module.HEAPU8.set(a,c);var i=Module._malloc(n),s=Module._malloc(u),_=Module._malloc(d);if(0!==Module.ccall("ge_frombytes_vartime","bool",["number","number"],[i,o]))throw"ge_frombytes_vartime returned non-zero error code";Module.ccall("ge_scalarmult","void",["number","number","number"],[s,c,i]),Module.ccall("ge_mul8","void",["number","number"],[_,s]),Module.ccall("ge_p1p1_to_p2","void",["number","number"],[s,_]);var f=Module._malloc(l);Module.ccall("ge_tobytes","void",["number","number"],[f,s]);var h=Module.HEAPU8.subarray(f,f+l);return Module._free(o),Module._free(c),Module._free(i),Module._free(s),Module._free(_),Module._free(f),P(h)},this.generate_key_derivation_2=function(e,t){return this.ge_scalarmult(e,t)},this.derivation_to_scalar=function(e,t){var r="";if(64!==e.length)throw"Invalid derivation length!";r+=e;var a=encode_varint(t);if(a.length>20)throw"output_index didn't fit in 64-bit varint";return r+=a,this.hash_to_scalar(r)},this.derive_secret_key=function(e,t,r){if(64!==e.length||64!==r.length)throw"Invalid input length!";var a=Module._malloc(c),o=U(this.derivation_to_scalar(e,t));Module.HEAPU8.set(o,a);var n=Module._malloc(l);Module.HEAPU8.set(U(r),n);var u=Module._malloc(c);Module.ccall("sc_add","void",["number","number","number"],[u,n,a]);var d=Module.HEAPU8.subarray(u,u+c);return Module._free(a),Module._free(n),Module._free(u),P(d)},this.derive_public_key=function(e,t,r){if(64!==e.length||64!==r.length)throw"Invalid input length!";var a=Module._malloc(l),o=U(e);Module.HEAPU8.set(o,a);var i=Module._malloc(l),_=U(r);Module.HEAPU8.set(_,i);var f=Module._malloc(n),h=Module._malloc(n),b=Module._malloc(160),m=Module._malloc(d),g=Module._malloc(u),v=Module._malloc(l);if(0!==Module.ccall("ge_frombytes_vartime","bool",["number","number"],[f,i]))throw"ge_frombytes_vartime returned non-zero error code";var M=Module._malloc(c),p=U(this.derivation_to_scalar(P(Module.HEAPU8.subarray(a,a+s)),t));Module.HEAPU8.set(p,M),Module.ccall("ge_scalarmult_base","void",["number","number"],[h,M]),Module.ccall("ge_p3_to_cached","void",["number","number"],[b,h]),Module.ccall("ge_add","void",["number","number","number"],[m,f,b]),Module.ccall("ge_p1p1_to_p2","void",["number","number"],[g,m]),Module.ccall("ge_tobytes","void",["number","number"],[v,g]);var y=Module.HEAPU8.subarray(v,v+l);return Module._free(a),Module._free(i),Module._free(M),Module._free(f),Module._free(h),Module._free(b),Module._free(m),Module._free(g),Module._free(v),P(y)},this.hash_to_ec=function(e){if(64!==e.length)throw"Invalid input length";var t=Module._malloc(32),r=Module._malloc(u),a=Module._malloc(d),o=Module._malloc(n),c=U(this.cn_fast_hash(e,l));Module.HEAPU8.set(c,t),Module.ccall("ge_fromfe_frombytes_vartime","void",["number","number"],[r,t]),Module.ccall("ge_mul8","void",["number","number"],[a,r]),Module.ccall("ge_p1p1_to_p3","void",["number","number"],[o,a]);var i=Module.HEAPU8.subarray(o,o+n);return Module._free(t),Module._free(r),Module._free(a),Module._free(o),P(i)},hash_to_ec_2=function(e){if(64!==e.length)throw"Invalid input length";var t=Module._malloc(32),r=Module._malloc(u),a=Module._malloc(d),o=Module._malloc(n),c=U(this.cn_fast_hash(e,l)),i=Module._malloc(l);Module.HEAPU8.set(c,t),Module.ccall("ge_fromfe_frombytes_vartime","void",["number","number"],[r,t]),Module.ccall("ge_mul8","void",["number","number"],[a,r]),Module.ccall("ge_p1p1_to_p3","void",["number","number"],[o,a]),Module.ccall("ge_p3_tobytes","void",["number","number"],[i,o]);var s=Module.HEAPU8.subarray(i,i+l);return Module._free(t),Module._free(r),Module._free(a),Module._free(o),Module._free(i),P(s)},hash_to_ec_3=function(e){if(64!==e.length)throw"Invalid input length";var t=Module._malloc(32),r=Module._malloc(u),a=U(this.cn_fast_hash(e,l)),o=Module._malloc(l);Module.HEAPU8.set(a,t),Module.ccall("ge_fromfe_frombytes_vartime","void",["number","number"],[r,t]),Module.ccall("ge_tobytes","void",["number","number"],[o,r]);var n=Module.HEAPU8.subarray(o,o+l);return Module._free(t),Module._free(r),Module._free(o),P(n)},this.generate_key_image_2=function(e,t){if(!e||!t||64!==e.length||64!==t.length)throw"Invalid input length";var r=Module._malloc(l),a=Module._malloc(l);if(Module.HEAPU8.set(U(e),r),Module.HEAPU8.set(U(t),a),0!==Module.ccall("sc_check","number",["number"],[a]))throw"sc_check(sec) != 0";var o=Module._malloc(n),d=Module._malloc(u),c=U(this.hash_to_ec(e));Module.HEAPU8.set(c,o);var i=Module._malloc(_);Module.ccall("ge_scalarmult","void",["number","number","number"],[d,a,o]),Module.ccall("ge_tobytes","void",["number","number"],[i,d]);var s=Module.HEAPU8.subarray(i,i+_);return Module._free(r),Module._free(a),Module._free(o),Module._free(d),Module._free(i),P(s)},this.generate_key_image=function(e,t,r,a,o){if(64!==e.length)throw"Invalid tx_pub length";if(64!==t.length)throw"Invalid view_sec length";if(64!==r.length)throw"Invalid spend_pub length";if(64!==a.length)throw"Invalid spend_sec length";var l=this.generate_key_derivation(e,t),n=this.derive_public_key(l,o,r),u=this.derive_secret_key(l,o,a);return{ephemeral_pub:n,key_image:this.generate_key_image_2(n,u)}},this.generate_key_image_helper=function(e,t,r){var a=this.generate_key_derivation(t,e.view.sec);if(!a)throw"Failed to generate key image";var o=this.derive_public_key(a,r,e.spend.pub);if(!o)throw"Failed to generate key image";var l=this.derive_secret_key(a,r,e.spend.sec);return{in_ephemeral:{pub:o,sec:l},image:this.generate_key_image_2(o,l)}},this.ge_neg=function(e){if(64!==e.length)throw"expected 64 char hex string";return e.slice(0,62)+((parseInt(e.slice(62,63),16)+8)%16).toString(16)+e.slice(63,64)},this.ge_add=function(e,t){var r=Module._malloc(l),a=Module._malloc(l),o=Module._malloc(n),c=Module._malloc(n);if(Module.HEAPU8.set(U(e),r),Module.HEAPU8.set(U(t),a),0!==Module.ccall("ge_frombytes_vartime","bool",["number","number"],[o,r]))throw"ge_frombytes_vartime returned non-zero error code";if(0!==Module.ccall("ge_frombytes_vartime","bool",["number","number"],[c,a]))throw"ge_frombytes_vartime returned non-zero error code";var i=Module._malloc(l),s=Module._malloc(u),_=Module._malloc(d),f=Module._malloc(160);Module.ccall("ge_p3_to_cached","void",["number","number"],[f,c]),Module.ccall("ge_add","void",["number","number","number"],[_,o,f]),Module.ccall("ge_p1p1_to_p2","void",["number","number"],[s,_]),Module.ccall("ge_tobytes","void",["number","number"],[i,s]);var h=Module.HEAPU8.subarray(i,i+l);return Module._free(r),Module._free(o),Module._free(a),Module._free(c),Module._free(s),Module._free(_),Module._free(i),Module._free(f),P(h)},this.ge_sub=function(e,t){return point2n=ge_neg(t),ge_add(e,point2n)},this.sc_add=function(e,t){if(64!==e.length||64!==t.length)throw"Invalid input length!";var r=Module._malloc(c),a=Module._malloc(c);Module.HEAPU8.set(U(e),r),Module.HEAPU8.set(U(t),a);var o=Module._malloc(c);Module.ccall("sc_add","void",["number","number","number"],[o,r,a]);var l=Module.HEAPU8.subarray(o,o+c);return Module._free(r),Module._free(a),Module._free(o),P(l)},this.sc_sub=function(e,t){if(64!==e.length||64!==t.length)throw"Invalid input length!";var r=Module._malloc(c),a=Module._malloc(c);Module.HEAPU8.set(U(e),r),Module.HEAPU8.set(U(t),a);var o=Module._malloc(c);Module.ccall("sc_sub","void",["number","number","number"],[o,r,a]);var l=Module.HEAPU8.subarray(o,o+c);return Module._free(r),Module._free(a),Module._free(o),P(l)},this.sc_mul=function(e,t){if(64!==e.length||64!==t.length)throw"Invalid input length!";return w(JSBigInt(k(e)).multiply(JSBigInt(k(t))).remainder(m).toString())},this.sc_mulsub=function(e,t,r){if(64!==r.length||64!==e.length||64!==t.length||!this.valid_hex(r)||!this.valid_hex(e)||!this.valid_hex(t))throw"bad scalar";var a=Module._malloc(l);Module.HEAPU8.set(U(t),a);var o=Module._malloc(l);Module.HEAPU8.set(U(e),o);var n=Module._malloc(l);Module.HEAPU8.set(U(r),n);var u=Module._malloc(l);return Module.ccall("sc_mulsub","void",["number","number","number","number"],[u,o,a,n]),res=Module.HEAPU8.subarray(u,u+l),Module._free(n),Module._free(a),Module._free(o),Module._free(u),P(res)},this.ge_double_scalarmult_base_vartime=function(e,t,r){var a=Module._malloc(l),o=Module._malloc(n);if(Module.HEAPU8.set(U(t),a),0!==Module.ccall("ge_frombytes_vartime","void",["number","number"],[o,a]))throw"Failed to call ge_frombytes_vartime";var d=Module._malloc(l);Module.HEAPU8.set(U(e),d);var c=Module._malloc(l);if(Module.HEAPU8.set(U(r),c),0!==Module.ccall("sc_check","number",["number"],[d])||0!==Module.ccall("sc_check","number",["number"],[c]))throw"bad scalar(s)";var i=Module._malloc(u),s=Module._malloc(l);Module.ccall("ge_double_scalarmult_base_vartime","void",["number","number","number","number"],[i,d,o,c]),Module.ccall("ge_tobytes","void",["number","number"],[s,i]);var _=Module.HEAPU8.subarray(s,s+l);return Module._free(a),Module._free(o),Module._free(d),Module._free(c),Module._free(i),Module._free(s),P(_)},this.ge_double_scalarmult_postcomp_vartime=function(e,t,r,a){var o=Module._malloc(_);Module.HEAPU8.set(U(a),o);var l=Module._malloc(n),d=Module._malloc(f),i=Module._malloc(n),h=Module._malloc(c),b=Module._malloc(c),m=Module._malloc(u),g=Module._malloc(s);if(0!==Module.ccall("ge_frombytes_vartime","void",["number","number"],[l,o]))throw"Failed to call ge_frombytes_vartime";Module.ccall("ge_dsm_precomp","void",["number","number"],[d,l]);var v=this.hash_to_ec(t);Module.HEAPU8.set(U(v),i),Module.HEAPU8.set(U(r),b),Module.HEAPU8.set(U(e),h),Module.ccall("ge_double_scalarmult_precomp_vartime","void",["number","number","number","number","number"],[m,h,i,b,d]),Module.ccall("ge_tobytes","void",["number","number"],[g,m]);var M=Module.HEAPU8.subarray(g,g+s);return Module._free(o),Module._free(l),Module._free(d),Module._free(i),Module._free(h),Module._free(b),Module._free(m),Module._free(g),P(M)},this.genBorromean=function(e,t,r,a,o){if(e.length!==o)throw"wrong xv length "+e.length;if(t.length!==a)throw"wrong pm size "+t.length;for(var l=0;l<t.length;l++)if(t[l].length!==o)throw"wrong pm["+l+"] length "+t[l].length;if(r.length!==o)throw"wrong iv length "+r.length;for(l=0;l<r.length;l++)if(r[l]>=a)throw"bad indices value at: "+l+": "+r[l];var n,u={s:[],ee:""},d=[];for(l=0;l<a;l++)u.s[l]=[],d[l]=[];var c=[];for(l=0;l<o;l++){n=parseInt(r[l]),c[l]=random_scalar(),d[n][l]=ge_scalarmult_base(c[l]);for(var i=n+1;i<a;i++){u.s[i][l]=random_scalar();var s=hash_to_scalar(d[i-1][l]);d[i][l]=ge_double_scalarmult_base_vartime(s,t[i][l],u.s[i][l])}}var _="";for(l=0;l<o;l++)_+=d[a-1][l];for(u.ee=hash_to_scalar(_),l=0;l<o;l++){var f=u.ee;for(i=0;i<indices[l];i++){u.s[i][l]=random_scalar();var h=ge_double_scalarmult_base_vartime(f,t[i][l],u.s[i][l]);f=hash_to_scalar(h)}u.s[i][l]=sc_mulsub(e[l],f,c[l])}return u},this.verBorromean=function(e,t){for(var r="",a=0;a<e.s[0].length;a++){for(var o=e.ee,l=0;l<e.s.length-1;l++){var n=ge_double_scalarmult_base_vartime(o,t[l][a],e.s[l][a]);o=hash_to_scalar(n)}console.log(l),r+=ge_double_scalarmult_base_vartime(o,t[l][a],e.s[l][a])}return hash_to_scalar(r)===e.ee},this.proveRange=function(e,t,r,a,o){for(var l,n=g,u=v,d=x(t),c={Ci:[]},i=[],s=[],_=0;_<2;_++)s[_]=[];for(_=0;_<r;_++){for(i[_]=random_scalar(),s[l=d[_]][_]=ge_scalarmult_base(i[_]);l>0;)s[--l][_]=ge_add(s[l+1][_],M[_]);for(l=d[_];l<1;)s[++l][_]=ge_sub(s[l-1][_],M[_]);u=sc_add(u,i[_])}for(_=0;_<r;_++)c.Ci[_]=s[0][_],n=ge_add(n,s[0][_]);return c.bsig=this.genBorromean(i,s,d,2,r),e.C=n,e.mask=u,c},this.MLSAG_Gen=function(e,t,r,a,o){var l=t.length;if(o>=l)throw"index out of range";var n=t[0].length;if(2!==n)throw"wrong row count";for(var u=0;u<l;u++)if(t[u].length!==n)throw"pk is not rectangular";if(r.length!==n)throw"bad xx size";var d="",c={ss:[],cc:null};for(u=0;u<l;u++)c.ss[u]=[];var i=[];for(i[0]=e,alpha[0]=random_scalar(),i[1]=t[o][0],i[2]=ge_scalarmult_base(alpha[0]),i[3]=generate_key_image_2(t[o][0],alpha[0]),alpha[1]=random_scalar(),i[4]=t[o][1],i[5]=ge_scalarmult_base(alpha[1]),d=E(i),0==(u=(o+1)%l)&&(c.cc=d);u!=o;)c.ss[u][0]=random_scalar(),c.ss[u][1]=random_scalar(),i[1]=t[u][0],i[2]=ge_double_scalarmult_base_vartime(d,t[u][0],c.ss[u][0]),i[3]=ge_double_scalarmult_postcomp_vartime(c.ss[u][0],t[u][0],d,a),i[4]=t[u][1],i[5]=ge_double_scalarmult_base_vartime(d,t[u][1],c.ss[u][1]),d=E(i),0==(u=(u+1)%l)&&(c.cc=d);for(u=0;u<n;u++)c.ss[o][u]=sc_mulsub(d,r[u],alpha[u]);return c},this.proveRctMG=function(e,t,r,a,o,l,n){var u=t.length;if(u<3)throw"cols must be > 2 (mixin)";for(var d=[],c=[[],[]],i=0;i<u;i++)c[i][0]=t[i].dest,c[i][1]=ge_sub(t[i].mask,l);return d[0]=r.x,d[1]=sc_sub(r.a,o),this.MLSAG_Gen(e,c,d,a,n)},this.genRct=function(e,t,r,a,o,l,n,u,d,c){if(l.length!==a.length||u.length!==a.length)throw"different number of amounts/amount_keys vs destinations";for(var i=0;i<n.length;i++){if(n[i].length>=d[i])throw"bad mixRing/index size";if(n[i].length!==t.length)throw"mismatched mixRing/inSk"}if(o.length!==t.length)throw"mismatched inAmounts/inSk";if(d.length!==t.length)throw"mismatched indices/inSk";rv={type:1===t.length?1:2,message:e,outPk:[],p:{rangeSigs:[],MGs:[]},ecdhInfo:[],txnFee:c,pseudoOuts:[]};var s=v,_={C:null,mask:null};for(i=0;i<a.length;i++)rv.p.rangeSigs[i]=this.proveRange(_,l[i],64,0,0),rv.outPk[i]=_.C,s=sc_add(s,_.mask),rv.ecdhInfo[i]={mask:sc_add(hash_to_scalar(u),_.mask),amount:sc_add(hash_to_scalar(hash_to_scalar(u)),w(l[i]))};if(2===rv.type){var f=[],h=v;for(i=0;i<o.length-1;i++)f[i]=random_scalar(),h=sc_add(h,f[i]),rv.pseudoOuts[i]=p(w(o[i]),f[i]);f[i]=sc_sub(s,h),rv.pseudoOuts[i]=p(w(o[i]),f[i]);var m=get_pre_mlsag_hash(rv);for(i=0;i<o.length;i++)rv.p.MGs[i]=this.proveRctMG(m,pubs[i],t[i],r[i],f[i],rv.pseudoOuts[i],d[i])}else{var M=g;for(i=0;i<a.length;i++)M=ge_add(M,rv.outPk[i]);M=ge_add(M,ge_scalarmult(b,w(c))),m=get_pre_mlsag_hash(rv),rv.p.MGs.push=this.proveRctMG(m,pubs[0],t[0],r[0],s,M,d[0])}return rv},this.add_pub_key_to_extra=function(e,t){if(64!==t.length)throw"Invalid pubkey length";return e+"01"+t},this.add_nonce_to_extra=function(e,t){if(t.length%2!=0)throw"Invalid extra nonce";if(t.length/2>255)throw"Extra nonce must be at most 255 bytes";return e+="02",(e+=("0"+(t.length/2).toString(16)).slice(-2))+t},this.get_payment_id_nonce=function(e,t){if(64!==e.length&&16!==e.length)throw"Invalid payment id";var r="";return(r+=t?"01":"00")+e},this.abs_to_rel_offsets=function(e){if(0===e.length)return e;for(var t=e.length-1;t>=1;--t)e[t]=new JSBigInt(e[t]).subtract(e[t-1]).toString();return e},this.get_tx_prefix_hash=function(e){var t=this.serialize_tx(e,!0);return this.cn_fast_hash(t)},this.get_tx_hash=function(e){return"string"==typeof e?this.cn_fast_hash(e):this.cn_fast_hash(this.serialize_tx(e))},this.serialize_tx=function(e,t){void 0===t&&(t=!1);var r,a,o="";for(o+=this.encode_varint(e.version),o+=this.encode_varint(e.unlock_time),o+=this.encode_varint(e.vin.length),r=0;r<e.vin.length;r++){var l=e.vin[r];switch(l.type){case"input_to_key":for(o+="02",o+=this.encode_varint(l.amount),o+=this.encode_varint(l.key_offsets.length),a=0;a<l.key_offsets.length;a++)o+=this.encode_varint(l.key_offsets[a]);o+=l.k_image;break;default:throw"Unhandled vin type: "+l.type}}for(o+=this.encode_varint(e.vout.length),r=0;r<e.vout.length;r++){var n=e.vout[r];switch(o+=this.encode_varint(n.amount),n.target.type){case"txout_to_key":o+="02",o+=n.target.key;break;default:throw"Unhandled txout target type: "+n.target.type}}if(!this.valid_hex(e.extra))throw"Tx extra has invalid hex";if(o+=this.encode_varint(e.extra.length/2),o+=e.extra,!t){if(e.vin.length!==e.signatures.length)throw"Signatures length != vin length";for(r=0;r<e.vin.length;r++)for(a=0;a<e.signatures[r].length;a++)o+=e.signatures[r][a]}return o},this.generate_signature=function(e,t,r){if(64!==r.length||!this.valid_hex(r))throw"Invalid secret key";if(64!==e.length||!this.valid_hex(e))throw"Invalid prefix hash";var a=this.random_scalar(),o=this.sec_key_to_pub(a),l=this.hash_to_scalar(e+t+o);return l+this.sc_mulsub(l,r,a)},this.check_signature=function(e,t,r){if(128!==r.length)return!1;if(64!==e.length||!this.valid_hex(e))throw"Invalid prefix hash";var a={};a.c=r.slice(0,h),a.r=r.slice(h,128);try{var o=this.ge_double_scalarmult_base_vartime(a.c,t,a.r)}catch(e){return!1}var l=this.hash_to_scalar(e+t+o);return a.c===l},this.generate_ring_signature=function(e,t,r,a,o){if(64!==t.length)throw"invalid key image length";if(64!==a.length)throw"Invalid secret key length";if(64!==e.length||!this.valid_hex(e))throw"Invalid prefix hash";if(o>=r.length||o<0)throw"real_index is invalid";var d=Module.cwrap("ge_tobytes","void",["number","number"]),i=Module.cwrap("ge_p3_tobytes","void",["number","number"]),b=Module.cwrap("ge_scalarmult_base","void",["number","number"]),m=Module.cwrap("ge_scalarmult","void",["number","number","number"]),g=Module.cwrap("sc_add","void",["number","number","number"]),v=Module.cwrap("sc_sub","void",["number","number","number"]),M=Module.cwrap("sc_mulsub","void",["number","number","number","number"]),p=Module.cwrap("sc_0","void",["number"]),y=Module.cwrap("ge_double_scalarmult_base_vartime","void",["number","number","number","number"]),w=Module.cwrap("ge_double_scalarmult_precomp_vartime","void",["number","number","number","number","number"]),k=Module.cwrap("ge_frombytes_vartime","number",["number","number"]),x=Module.cwrap("ge_dsm_precomp","void",["number","number"]),E=64*r.length,A=Module._malloc(E),I=h*r.length,H=Module._malloc(I);function S(e){return A+s*(2*e)}function B(e){return A+s*(2*e+1)}function J(e){return H+c*(2*e)}function F(e){return H+c*(2*e+1)}var R,O=Module._malloc(_);Module.HEAPU8.set(U(t),O);var z=Module._malloc(n),G=Module._malloc(f),N=Module._malloc(c),T=Module._malloc(c),C=Module._malloc(c),D=Module._malloc(u),Z=Module._malloc(n),L=Module._malloc(l),W=Module._malloc(l);if(Module.HEAPU8.set(U(a),W),0!=k(z,O))throw"failed to call ge_frombytes_vartime";for(x(G,z),p(N),R=0;R<r.length;R++)if(R===o){var j=this.random_scalar();Module.HEAPU8.set(U(j),T),b(Z,T),i(S(R),Z);var V=this.hash_to_ec(r[R]);Module.HEAPU8.set(U(V),Z),m(D,T,Z),d(B(R),D)}else{if(Module.HEAPU8.set(U(this.random_scalar()),J(R)),Module.HEAPU8.set(U(this.random_scalar()),F(R)),Module.HEAPU8.set(U(r[R]),L),0!==Module.ccall("ge_frombytes_vartime","void",["number","number"],[Z,L]))throw"Failed to call ge_frombytes_vartime";y(D,J(R),Z,F(R)),d(S(R),D),V=this.hash_to_ec(r[R]),Module.HEAPU8.set(U(V),Z),w(D,F(R),Z,J(R),G),d(B(R),D),g(N,N,J(R))}var $=Module.HEAPU8.subarray(A,A+E),q=this.hash_to_scalar(e+P($));Module.HEAPU8.set(U(q),C),v(J(o),C,N),M(F(o),J(o),W,T);for(var K=P(Module.HEAPU8.subarray(H,H+I)),Q=[],X=0;X<r.length;X++)Q.push(K.slice(128*X,128*(X+1)));return Module._free(O),Module._free(z),Module._free(G),Module._free(N),Module._free(T),Module._free(C),Module._free(D),Module._free(Z),Module._free(A),Module._free(H),Module._free(L),Module._free(W),Q},this.check_ring_signature=function(e,t,r,a){if(64!==t.length)throw"invalid key image length";if(64!==e.length||!this.valid_hex(e))throw"Invalid prefix hash";if(a.length!==r.length)throw"number of sigs doesn't match number of pubs";var o=Module.cwrap("ge_tobytes","void",["number","number"]),d=(Module.cwrap("ge_p3_tobytes","void",["number","number"]),Module.cwrap("sc_add","void",["number","number","number"])),i=Module.cwrap("sc_0","void",["number"]),b=Module.cwrap("ge_double_scalarmult_base_vartime","void",["number","number","number","number"]),m=Module.cwrap("ge_double_scalarmult_precomp_vartime","void",["number","number","number","number","number"]),g=Module.cwrap("ge_frombytes_vartime","number",["number","number"]),v=Module.cwrap("ge_dsm_precomp","void",["number","number"]),M=a.join(""),p=64*r.length,y=Module._malloc(p),w=h*r.length,k=Module._malloc(w);function x(e){return y+s*(2*e)}function E(e){return y+s*(2*e+1)}function A(e){return k+c*(2*e)}function I(e){return k+c*(2*e+1)}Module.HEAPU8.set(U(M),k);var H=Module._malloc(_);Module.HEAPU8.set(U(t),H);var S=Module._malloc(n),B=Module._malloc(f),J=Module._malloc(c),F=Module._malloc(u),R=Module._malloc(n),O=Module._malloc(l);if(0!=g(S,H))throw"failed to call ge_frombytes_vartime";v(B,S),i(J);for(var z=0;z<r.length;z++){if(0!==Module.ccall("sc_check","number",["number"],[A(z)])||0!==Module.ccall("sc_check","number",["number"],[I(z)]))return console.log("bad sc"),!1;if(Module.HEAPU8.set(U(r[z]),O),0!==Module.ccall("ge_frombytes_vartime","void",["number","number"],[R,O]))throw"Failed to call ge_frombytes_vartime";b(F,A(z),R,I(z)),o(x(z),F);var G=this.hash_to_ec(r[z]);Module.HEAPU8.set(U(G),R),m(F,I(z),R,A(z),B),o(E(z),F),d(J,J,A(z))}var N=Module.HEAPU8.subarray(y,y+p),T=this.hash_to_scalar(e+P(N)),C=P(Module.HEAPU8.subarray(J,J+l));return Module._free(H),Module._free(S),Module._free(B),Module._free(J),Module._free(F),Module._free(R),Module._free(y),Module._free(k),Module._free(O),T===C},this.check_ring=function(e,t,r,a){if(64!==t.length)return console.log("invalid key image length"),!1;if(64!==e.length||!this.valid_hex(e))return console.log("Invalid prefix hash"),!1;if(a.length!==r.length)return console.log("number of sigs doesn't match number of pubs"),!1;for(var o=[],l=0;l<a.length;l++)o[l]={c:a[l].slice(0,64),r:a[l].slice(64)};var n=e,u=d2h256("0");for(l=0;l<r.length;l++)try{n+=this.ge_double_scalarmult_base_vartime(o[l].c,r[l],o[l].r),n+=this.ge_double_scalarmult_postcomp_vartime(o[l].r,r[l],o[l].c,t),u=sc_add(u,o[l].c)}catch(e){return console.log(e),!1}return u===hash_to_scalar(n)},this.construct_tx=function(e,t,r,a,o,l,n,u){var d=this.random_keypair(),c="";if(o){if(l&&16!==o.length)throw"payment ID must be 8 bytes to be encrypted!";if(console.log("Adding payment id: "+o),l){var i=this.cn_fast_hash(this.generate_key_derivation(n,d.sec)+141..toString(16)).slice(0,16);console.log("Txkeys:",d,"Payment ID key:",i),o=this.hex_xor(o,i)}var s=this.get_payment_id_nonce(o,l);console.log("Extra nonce: "+s),c=this.add_nonce_to_extra(c,s)}var _={unlock_time:u,version:1,extra:c,vin:[],vout:[],signatures:[]};_.extra=this.add_pub_key_to_extra(_.extra,d.pub);var f,h,b=[],m=JSBigInt.ZERO;for(console.log("Sources: "),f=0;f<t.length;f++){if(console.log(f+": "+this.formatMoneyFull(t[f].amount)),t[f].real_out>=t[f].outputs.length)throw"real index >= outputs.length";m=m.add(t[f].amount);var g=this.generate_key_image_helper(e,t[f].real_out_tx_key,t[f].real_out_in_tx);if(b.push(g.in_ephemeral),g.in_ephemeral.pub!==t[f].outputs[t[f].real_out].key)throw"in_ephemeral.pub != source.real_out.key";var v={type:"input_to_key"};for(v.amount=t[f].amount,v.k_image=g.image,v.key_offsets=[],h=0;h<t[f].outputs.length;++h)v.key_offsets.push(t[f].outputs[h].index);v.key_offsets=this.abs_to_rel_offsets(v.key_offsets),_.vin.push(v)}var M=JSBigInt.ZERO,p=0;for(f=0;f<r.length;++f){if(1!==new JSBigInt(r[f].amount).compare(0))throw"dst.amount <= 0";r[f].keys=this.decode_address(r[f].address);var y=this.generate_key_derivation(r[f].keys.view,d.sec),w=this.derive_public_key(y,p,r[f].keys.spend),k={amount:r[f].amount.toString()};k.target={type:"txout_to_key",key:w},_.vout.push(k),++p,M=M.add(r[f].amount)}if(M.add(a).compare(m)>0)throw"outputs money ("+this.formatMoneyFull(M)+") + fee ("+this.formatMoneyFull(a)+") > inputs money ("+this.formatMoneyFull(m)+")";var x=this.get_tx_prefix_hash(_);for(f=0;f<t.length;++f){var U=[];for(h=0;h<t[f].outputs.length;++h)U.push(t[f].outputs[h].key);var P=this.generate_ring_signature(x,_.vin[f].k_image,U,b[f].sec,t[f].real_out);_.signatures.push(P)}return _},this.create_transaction=function(e,t,r,a,l,n,u,d,c,i,s){var _,f;if(s=s||0,l=l||[],0===r.length)throw"Destinations empty";if(l.length!==a.length&&0!==n)throw"Wrong number of mix outs provided ("+a.length+" outputs, "+l.length+" mix outs)";for(_=0;_<l.length;_++)if((l[_].outputs||[]).length<n)throw"Not enough outputs to mix with";var h={view:{pub:e.view,sec:t.view},spend:{pub:e.spend,sec:t.spend}};if(!this.valid_keys(h.view.pub,h.view.sec,h.spend.pub,h.spend.sec))throw"Invalid secret keys!";var b=JSBigInt.ZERO;for(_=0;_<r.length;++_)if(-1!==(b=b.add(r[_].amount)).compare(o))throw"Output overflow!";var m=JSBigInt.ZERO,g=[];for(console.log("Selected transfers: ",a),_=0;_<a.length;++_){if(-1!==(m=m.add(a[_].amount)).compare(o))throw"Input overflow!";var v={outputs:[]};if(v.amount=new JSBigInt(a[_].amount).toString(),0!==l.length)for(l[_].outputs.sort((function(e,t){return new JSBigInt(e.global_index).compare(t.global_index)})),f=0;v.outputs.length<n&&f<l[_].outputs.length;){var M=l[_].outputs[f];if(M.global_index!==a[_].global_index){var p={};p.index=M.global_index.toString(),p.key=M.public_key,v.outputs.push(p),f++}else console.log("got mixin the same as output, skipping"),f++}var y={};y.index=new JSBigInt(a[_].global_index||0).toString(),y.key=a[_].public_key;var w=v.outputs.length;for(f=0;f<v.outputs.length;f++)if(new JSBigInt(y.index).compare(v.outputs[f].index)<0){w=f;break}v.outputs.splice(w,0,y),v.real_out_tx_key=a[_].tx_pub_key,v.real_out=w,v.real_out_in_tx=a[_].index,g.push(v)}console.log("sources: ",g);var k={amount:JSBigInt.ZERO},x=b.compare(m);if(x<0)k.amount=m.subtract(b);else if(x>0)throw"Need more money than found! (have: "+cnUtil.formatMoney(m)+" need: "+cnUtil.formatMoney(b)+")";return this.construct_tx(h,g,r,u,d,c,i,s)},this.printDsts=function(e){for(var t=0;t<e.length;t++)console.log(e[t].address+": "+this.formatMoneyFull(e[t].amount))},this.formatMoneyFull=function(e){var r,a="-"===(e=e.toString())[0]?"-":"";return"-"===a&&(e=e.slice(1)),r=e.length>=t.coinUnitPlaces?e.substr(e.length-t.coinUnitPlaces,t.coinUnitPlaces):function(e,t,r){for(;e.length<t;)e="0"+e;return e}(e,t.coinUnitPlaces),a+(e.substr(0,e.length-t.coinUnitPlaces)||"0")+"."+r},this.formatMoneyFullSymbol=function(e){return this.formatMoneyFull(e)+" "+t.coinSymbol},this.formatMoney=function(e){var t=function(e,t){for(;"0"==e[e.length-1];)e=e.slice(0,-1);return e}(this.formatMoneyFull(e));return"."===t[t.length-1]?t.slice(0,t.length-1):t},this.formatMoneySymbol=function(e){return this.formatMoney(e)+" "+t.coinSymbol},this.parseMoney=function(e){if(!e)return JSBigInt.ZERO;var r="-"===e[0];r&&(e=e.slice(1));var a=e.indexOf(".");return-1==a?r?JSBigInt.multiply(e,t.coinUnits).negate():JSBigInt.multiply(e,t.coinUnits):(a+t.coinUnitPlaces+1<e.length&&(e=e.substr(0,a+t.coinUnitPlaces+1)),r?new JSBigInt(e.substr(0,a)).exp10(t.coinUnitPlaces).add(new JSBigInt(e.substr(a+1)).exp10(a+t.coinUnitPlaces-e.length+1)).negate:new JSBigInt(e.substr(0,a)).exp10(t.coinUnitPlaces).add(new JSBigInt(e.substr(a+1)).exp10(a+t.coinUnitPlaces-e.length+1)))},this.decompose_amount_into_digits=function(e){e=e.toString();for(var t=[];e.length>0;){if("0"!==e[0]){for(var r=e[0];r.length<e.length;)r+="0";t.push(new JSBigInt(r))}e=e.slice(1)}return t},this.decompose_tx_destinations=function(e){for(var t=[],r=0;r<e.length;r++)for(var a=this.decompose_amount_into_digits(e[r].amount),o=0;o<a.length;o++)a[o].compare(0)>0&&t.push({address:e[r].address,amount:a[o]});return t.sort((function(e,t){return e.amount-t.amount}))},this.is_tx_unlocked=function(e,r){if(!t.maxBlockNumber)throw"Max block number is not set in config!";return e<t.maxBlockNumber?r>=e:Math.round((new Date).getTime()/1e3)>=e},this.tx_locked_reason=function(e,r){if(e<t.maxBlockNumber){var a=e-r;if(a<=0)return"Transaction is unlocked";var o=moment().add(a*t.avgBlockTime,"seconds");return"Will be unlocked in "+a+" blocks, ~"+o.fromNow(!0)+", "+o.calendar()}if(e-Math.round((new Date).getTime()/1e3)<=0)return"Transaction is unlocked";var l=moment(1e3*e);return"Will be unlocked "+l.fromNow()+", "+l.calendar()},this}(config);
